mapboxgl.accessToken="pk.eyJ1IjoiYW5kb3JyYXR1cmlzbWUiLCJhIjoiY2pscnR6eTViMDd5ajNrcGx2Mm54NjB2cCJ9.-3iD7LP54lnFI6kvNUJwQg",$(document).ready(function(){$(".mapbox_tab_map").each(function(e,t){if(0===e){var o=$(t),a=new mapboxgl.Map({container:o.attr("id"),style:"mapbox://styles/mapbox/streets-v9",center:[1.5218,42.5063],zoom:10});a.loadImage("/bundles/app/img/poi_icon.png",function(e,t){if(e)throw e;a.addImage("poi_icon",t)});var n=$("#idt-map-geojson0").text(),r=JSON.parse(n),s=r.source.data.features,i=new mapboxgl.LngLatBounds;a.on("load",function(){a.addSource("markerjson",{type:"geojson",data:r.source.data,cluster:!0,clusterMaxZoom:25,clusterRadius:50}),a.addLayer({id:"clusters",type:"circle",source:"markerjson",filter:["has","point_count"],paint:{"circle-color":"#398be7","circle-radius":35}}),a.addLayer({id:"cluster-count",type:"symbol",source:"markerjson",filter:["has","point_count"],layout:{"text-field":"{point_count_abbreviated}","text-font":["DIN Offc Pro Medium","Arial Unicode MS Bold"],"text-size":14},paint:{"text-color":"#ffffff"}}),a.addLayer({id:"unclustered-point",type:r.type,source:"markerjson",filter:["!",["has","point_count"]],layout:{"icon-image":r.layout["icon-image"],"icon-size":r.layout["icon-size"],"icon-allow-overlap":r.layout["icon-allow-overlap"]}}),s.forEach(function(e){i.extend(e.geometry.coordinates)}),a.fitBounds(i,{padding:{top:50,bottom:50,left:50,right:50}})}),a.on("click","unclustered-point",function(e){var t=e.features[0].geometry.coordinates.slice(),o=e.features[0].properties.description;for(a.flyTo({center:e.features[0].geometry.coordinates});Math.abs(e.lngLat.lng-t[0])>180;)t[0]+=e.lngLat.lng>t[0]?360:-360;(new mapboxgl.Popup).setLngLat(t).setHTML(o).setMaxWidth("580px").addTo(a)}),a.on("mouseenter","unclustered-point",function(){a.getCanvas().style.cursor="pointer"}),a.on("mouseleave","unclustered-point",function(){a.getCanvas().style.cursor=""}),a.on("click","clusters",function(e){var t=a.queryRenderedFeatures(e.point,{layers:["clusters"]}),o=t[0].properties.cluster_id;a.getSource("markerjson").getClusterExpansionZoom(o,function(e,o){e||a.easeTo({center:t[0].geometry.coordinates,zoom:o})})}),a.on("mouseenter","clusters",function(){a.getCanvas().style.cursor="pointer"}),a.on("mouseleave","clusters",function(){a.getCanvas().style.cursor=""})}}),$("button.idt-load-sheetmap").on("click",function(e){var t=$(e.target).attr("data-target"),o=$("#"+t),a=$(o).attr("data-init"),n=$(o).attr("data-map-index0");if(!a){var r=$(o).attr("data-map"),s=($("#"+r),$("#idt-map-geojson"+n)),i=$(s).text(),c=new mapboxgl.Map({container:r,style:"mapbox://styles/mapbox/streets-v9",center:[1.5218,42.5063],zoom:10});c.loadImage("/bundles/app/img/poi_icon.png",function(e,t){if(e)throw e;c.addImage("poi_icon",t)}),c.on("load",function(){var e=JSON.parse(i),t=e.source.data.features,o=new mapboxgl.LngLatBounds;c.addSource("markerjson",{type:"geojson",data:e.source.data,cluster:!0,clusterMaxZoom:25,clusterRadius:50}),c.addLayer({id:"clusters",type:"circle",source:"markerjson",filter:["has","point_count"],paint:{"circle-color":"#398be7","circle-radius":35}}),c.addLayer({id:"cluster-count",type:"symbol",source:"markerjson",filter:["has","point_count"],layout:{"text-field":"{point_count_abbreviated}","text-font":["DIN Offc Pro Medium","Arial Unicode MS Bold"],"text-size":14},paint:{"text-color":"#ffffff"}}),c.addLayer({id:"unclustered-point",type:e.type,source:"markerjson",filter:["!",["has","point_count"]],layout:{"icon-image":e.layout["icon-image"],"icon-size":e.layout["icon-size"],"icon-allow-overlap":e.layout["icon-allow-overlap"]}}),t.forEach(function(e){o.extend(e.geometry.coordinates)}),c.fitBounds(o,{padding:{top:50,bottom:50,left:50,right:50}})}),$(o).attr("data-init",!0),c.on("click","unclustered-point",function(e){for(var t=e.features[0].geometry.coordinates.slice(),o=e.features[0].properties.description;Math.abs(e.lngLat.lng-t[0])>180;)t[0]+=e.lngLat.lng>t[0]?360:-360;(new mapboxgl.Popup).setLngLat(t).setHTML(o).setMaxWidth("580px").addTo(c)}),c.on("mouseenter","unclustered-point",function(){c.getCanvas().style.cursor="pointer"}),c.on("mouseleave","unclustered-point",function(){c.getCanvas().style.cursor=""}),c.on("click","clusters",function(e){var t=c.queryRenderedFeatures(e.point,{layers:["clusters"]}),o=t[0].properties.cluster_id;c.getSource("markerjson").getClusterExpansionZoom(o,function(e,o){e||c.easeTo({center:t[0].geometry.coordinates,zoom:o})})}),c.on("mouseenter","clusters",function(){c.getCanvas().style.cursor="pointer"}),c.on("mouseleave","clusters",function(){c.getCanvas().style.cursor=""})}}),$(".map-tabs select").on("change",function(e){var t=$(e.target).val(),o=$("#"+t),a=$(o).attr("data-init"),n=$(o).attr("data-map-index0");if(!a){var r=$(o).attr("data-map"),s=($("#"+r),$("#idt-map-geojson"+n)),i=$(s).text(),c=new mapboxgl.Map({container:r,style:"mapbox://styles/mapbox/streets-v9",center:[1.5218,42.5063],zoom:10});c.loadImage("/bundles/app/img/poi_icon.png",function(e,t){if(e)throw e;c.addImage("poi_icon",t)}),c.on("load",function(){c.addLayer(JSON.parse(i));var e=JSON.parse(i),t=e.source.data.features,o=new mapboxgl.LngLatBounds;c.addSource("markerjson",{type:"geojson",data:e.source.data,cluster:!0,clusterMaxZoom:25,clusterRadius:50}),c.addLayer({id:"clusters",type:"circle",source:"markerjson",filter:["has","point_count"],paint:{"circle-color":"#398be7","circle-radius":35}}),c.addLayer({id:"cluster-count",type:"symbol",source:"markerjson",filter:["has","point_count"],layout:{"text-field":"{point_count_abbreviated}","text-font":["DIN Offc Pro Medium","Arial Unicode MS Bold"],"text-size":14},paint:{"text-color":"#ffffff"}}),c.addLayer({id:"unclustered-point",type:e.type,source:"markerjson",filter:["!",["has","point_count"]],layout:{"icon-image":e.layout["icon-image"],"icon-size":e.layout["icon-size"],"icon-allow-overlap":e.layout["icon-allow-overlap"]}}),t.forEach(function(e){o.extend(e.geometry.coordinates)}),c.fitBounds(o,{padding:{top:50,bottom:50,left:50,right:50}})}),$(o).attr("data-init",!0),c.on("click","unclustered-point",function(e){for(var t=e.features[0].geometry.coordinates.slice(),o=e.features[0].properties.description;Math.abs(e.lngLat.lng-t[0])>180;)t[0]+=e.lngLat.lng>t[0]?360:-360;(new mapboxgl.Popup).setLngLat(t).setHTML(o).setMaxWidth("580px").addTo(c)}),c.on("mouseenter","unclustered-point",function(){c.getCanvas().style.cursor="pointer"}),c.on("mouseleave","unclustered-point",function(){c.getCanvas().style.cursor=""}),c.on("click","clusters",function(e){var t=c.queryRenderedFeatures(e.point,{layers:["clusters"]}),o=t[0].properties.cluster_id;c.getSource("markerjson").getClusterExpansionZoom(o,function(e,o){e||c.easeTo({center:t[0].geometry.coordinates,zoom:o})})}),c.on("mouseenter","clusters",function(){c.getCanvas().style.cursor="pointer"}),c.on("mouseleave","clusters",function(){c.getCanvas().style.cursor=""})}})});
var didScroll=!1,lastScrollTop=0,delta=5,navbarHeight=$(".main-nav").outerHeight();$(function(){$(window).off("scroll"),$(window).scroll(function(a){didScroll=!0}),setInterval(function(){didScroll&&(!function(){var a=$(window).scrollTop();(function(){var a=$(window).scrollTop();if(1==$(".jumbotron-fixed-estacio").length)var e=$(".jumbotron-fixed-estacio");else if(1==$(".jumbotron-fixed").length)var e=$(".jumbotron-fixed");else var e=$(".jumbotron-carousel");e.height()+$(".header-nav-fixed").height()>=a||0==a?$(".header-nav-fixed").removeClass("show").addClass("hide"):$(".header-nav-fixed").removeClass("hide").addClass("show")})(),$(".jumbotron-left-fixed-planificador").length&&(e=$(window).scrollTop(),$(".jumbotron-left-fixed-planificador").height()+$(".header-nav-fixed-planificador").height()>=e?$(".header-nav-fixed-planificador").removeClass("show").addClass("hide"):$(".header-nav-fixed-planificador").removeClass("hide").addClass("show"));var e;$(".jumbotron-left-fixed-planificador-user").length&&function(){var a=$(window).scrollTop();$(".jumbotron-left-fixed-planificador-user").height()+$(".header-nav-fixed-planificador").height()>=a?$(".header-nav-fixed-planificador").removeClass("show").addClass("hide"):$(".header-nav-fixed-planificador").removeClass("hide").addClass("show")}();$(".goto").length&&$(".goto").each(function(a){var e,o,d,i,n=$(this).attr("data-target");if(0==$("#"+n).length)$(this).css("display","none");else{var l=(e=$("#"+n),o=e.offset().top+e.outerHeight(),d=$(window).scrollTop(),i=d+$(window).height(),o>d&&o-200<i);l&&($(this).parent().find(".active").removeClass("active"),$(this).addClass("active"))}});if(Math.abs(lastScrollTop-a)<=delta)return;a>lastScrollTop&&a>navbarHeight?($(".main-nav").removeClass("nav-down").addClass("nav-up"),$(".header-nav-fixed").removeClass("nav-down").addClass("nav-up"),$(".header-nav-fixed-planificador").removeClass("nav-down").addClass("nav-up"),$(".main-nav-mobile").removeClass("nav-down").addClass("nav-up")):a+$(window).height()<$(document).height()&&($(".main-nav").removeClass("nav-up").addClass("nav-down"),$(".header-nav-fixed").removeClass("nav-up").addClass("nav-down"),$(".header-nav-fixed-planificador").removeClass("nav-up").addClass("nav-down"),$(".main-nav-mobile").removeClass("nav-up").addClass("nav-down"));lastScrollTop=a}(),didScroll=!1)},250)});
function redrawCircleProgess(){$(".barchart_progress .percent").each(function(){var e=parseFloat($(this).attr("data-value")),t=parseFloat($(this).attr("data-maxvalue")),a=parseFloat(e/t*100);$(this).css("width",a+"%")}),$(".circle").each(function(){var e=parseFloat($(this).attr("r")),t=parseFloat($(this).attr("data-value")),a=parseFloat($(this).attr("data-maxvalue")),o=parseFloat(t/a*100),n=Math.PI*(2*e),d=n*(1-o/100);$(this).attr("stroke-dasharray",n),$(this).attr("stroke-dashoffset",d)})}function initLoadMore(){var e=document.getElementById("loadMorePromotions"),t=document.getElementsByClassName("and_container_lm_esdev")[0],a=0,o=0;e&&e.addEventListener("click",function(e){e.preventDefault();var n=e.currentTarget,d=n.attributes.getNamedItem("data-url").value,r=n.attributes.getNamedItem("data-offset").value,i=n.attributes.getNamedItem("data-json").value,l=n.attributes.getNamedItem("data-limit").value,s=n.attributes.getNamedItem("data-locationid").value;null!==n.attributes.getNamedItem("data-date-start")&&(a=n.attributes.getNamedItem("data-date-start").value),null!==n.attributes.getNamedItem("data-date-end")&&(o=n.attributes.getNamedItem("data-date-end").value),i={contentIdsArr:i.replace(/"/g,""),limit:l,offset:r,locationid:s,date_start:a,date_end:o},$.ajax({method:"POST",url:d,data:JSON.stringify(i),dataType:"html",context:document.body}).done(function(e){n.remove(),$(t).append(e),initLoadMore()})},!1)}function refreshWebcamImages(e){var t=new Date,a="?v="+t.getFullYear()+t.getMonth()+t.getDate()+t.getHours()+t.getMinutes(),o=e.target;$(o).find("img").each(function(){src=$(this).attr("data-src").replace(/\?v=.+/gi,a),$(this).attr("src",src)})}function initWeather(){$(".owl-carousel.webcam-carousel").owlCarousel({onInitialize:refreshWebcamImages,items:1,loop:!0,nav:!0,dots:!1,navText:["<i class='icon-izquierda2'></i>","<i class='icon-derecha2'></i>"]}),$("#idt-w-element-mobile-button").click(function(){$(".viewport").attr("data-level-showing",1),$(".level-1").show();var e=$(this).attr("data-target");$(".level-1").find("[data-parent='"+e+"']").show(),$("#idt-meteo-container-mobile-tab").css("display","block")}),$("#idt-meteo-container-mobile-tab .back").click(function(){$(".viewport").attr("data-level-showing",0),$(".level-1").fadeOut("slow"),$(".level-1 .sublevel").fadeOut("slow")})}function weatherRequest(){var e=document.getElementById("weather-req-url"),t=$(e).attr("data-url");e&&$.ajax({method:"GET",url:t,dataType:"html",context:document.body}).done(function(e){var t=$(e).filter("div#idt-w-element"),a=$(e).filter("div#idt-w-element-mobile"),o=$(e).filter("div#idt-w-element-mobile-tab");if(t){var n=document.getElementById("idt-meteo-container");n&&$(n).append($(t).html());var d=document.getElementById("idt-meteo-container-mobile");d&&a&&$(d).append($(a).html());var r=document.getElementById("idt-meteo-container-mobile-tab");r&&o&&$(r).append($(o).html()),initWeather()}})}handleSelectLanguageSwitcher=function(e){url=`${e.dataset.path}?to=${e.value}`,$.ajax({method:"GET",url:url,dataType:"json"}).done(function(e){e.url&&(window.location.href=e.url)})};var promise,active=!1;function searchByTextAndFilters(e,t){$.trim(e).length>2&&(active&&promise&&promise.abort(),t=t||[],active=!0,(promise=$.ajax({method:"POST",url:$(".search .search-input").data("search-url"),data:JSON.stringify({type:"fulltext",query:e,filters:t})})).done(function(t){t.results;$("header .results").html(t.results),$("#seeAllResults").attr("href",t.advSearchUrl+"?s="+$.trim(e)),active=!1}),promise.fail())}function directSearch(e){if(e){var t=e.data("search-base-url");t+="?s="+e.val(),window.location.href=t}}function post_to_url(e,t,a){a=a||"post";var o=document.createElement("form");for(var n in o.setAttribute("method",a),o.setAttribute("action",e),t)if(t.hasOwnProperty(n)){var d=document.createElement("input");d.setAttribute("type","hidden"),d.setAttribute("name",n),d.setAttribute("value",t[n]),o.appendChild(d)}document.body.appendChild(o),o.submit()}$(window).on("hashchange",function(e){"login"===window.location.hash.substr(1)&&($("#modal-user-wrapper").on("hinclude",function(){$("#modal-login").length&&($("#modal-login").modal("show"),window.location.hash="")}),$("#modal-login").length&&($("#modal-login").modal("show"),window.location.hash=""))}),"login"===window.location.hash.substr(1)&&($("#modal-user-wrapper").on("hinclude",function(){$("#modal-login").length&&($("#modal-login").modal("show"),window.location.hash="")}),$("#modal-login").length&&($("#modal-login").modal("show"),window.location.hash=""));var otherModalOpened=!1,jsKeepOtherModal=function(e){$(e).on("show.bs.modal",function(){otherModalOpened=$("body").hasClass("modal-open")}),$(e).on("hidden.bs.modal",function(){otherModalOpened&&$("body").addClass("modal-open")})},jsLoader=function(e){e.loaderSelector="div.main-loader-holder";var t=!1;return e.show=function(){otherModalOpened=$("body").hasClass("modal-open"),$("body").addClass("modal-open").css("padding-right","15px"),0===$("body > div.loader-backdrop").length&&$("body").append('<div class="loader-backdrop fade show"></div>'),$(e.loaderSelector).addClass("show"),t=!0},e.hide=function(){setTimeout(function(){$(e.loaderSelector).removeClass("show"),$("body > div.loader-backdrop").remove(),otherModalOpened||$("body").removeClass("modal-open").css({paddingLeft:"",paddingRight:""}),t=!1},500)},e.toggle=function(){t?e.hide():e.show()},e}(jsLoader||{});document.querySelectorAll(".season-link").forEach(e=>{void 0===e.dataset.planificadorModal&&e.addEventListener("click",t=>{t.stopImmediatePropagation(),t.preventDefault(),url=`${e.dataset.path}?to=${e.dataset.shadow}`,$.ajax({method:"GET",url:url,dataType:"json"}).done(function(e){e.url&&(window.location.href=e.url)})})});